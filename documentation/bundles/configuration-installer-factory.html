<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Configuration Installer Factory</title>
        <link rel="icon" href="/res/favicon.ico"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
<div class="title">
            <div class="logo">
                <a href="http://sling.apache.org">
                    <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                </a>
            </div><div class="header">
                <a href="http://www.apache.org">
                    <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                </a>
            </div>
        </div><nav class="menu">
            <ul>
                <li>
                    <strong>Documentation</strong><ul>
                        <li><a href="/documentation.html">Main</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="http://sling.apache.org/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                    </ul>
                </li><li>
                    <strong>API Docs</strong><ul>
                        <li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                    </ul>
                </li><li>
                    <strong>Support</strong><ul>
                        <li><a href="http://s.apache.org/sling.wiki">Wiki</a></li><li><a href="http://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Site Map</a></li>
                    </ul>
                </li><li>
                    <strong>Project Info</strong><ul>
                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="http://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                    </ul>
                </li><li>
                    <strong>Source</strong><ul>
                        <li><a href="https://github.com/apache/?utf8=%E2%9C%93&q=sling">GitHub</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                    </ul>
                </li><li>
                    <strong>Apache Software Foundation</strong><ul>
                        <li><a href="http://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="http://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li><li><a href="https://www.apache.org/events/current-event.html">
                                <img border="0" alt="Current ASF Events" src="https://www.apache.org/events/current-event-125x125.png" width="125"/>
                            </a></li><li><a href="http://apache.org/foundation/contributing.html">
                                <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                            </a></li>
                    </ul>
                </li>
            </ul>
        </nav>        <div class="main">
            <div class="pagenav">
<div class="breadcrumbs">
                    <a href="/">
                        Home
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation.html">
                        Documentation
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation/bundles.html">
                        Bundles
                    </a>&nbsp;&raquo;&nbsp;
                </div>                
<div class="tags">
                    <a href="/tags/installer.html" class="label">
                        installer
                    </a> 
                </div>                
                
            </div><h1 class="pagetitle">
                Configuration Installer Factory
            </h1><div id="generatedToC"></div><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=pagetitle],h2,h3'}); } );</script>
<div class="row"><div class="small-12 columns"><section class="wrap"><p>The configuration installer factory provides support for configurations to the <a href="/documentation/bundles/osgi-installer.html">OSGI installer</a>. The provisioning of artifacts is handled by installer providers like the file installer or the JCR installer.</p>
<h2><a href="#configurations" name="configurations">Configurations</a></h2>
<p>Configuration file names are related to the PID and factory PID. The structure of the file name is as follows:</p>
<pre><code>filename ::= &lt;pid&gt; ( &#39;-&#39; &lt;subname&gt; )? (&#39;.cfg&#39;|&#39;.config&#39;)
</code></pre>
<p>If the form is <code>&lt;pid&gt;(&#39;.cfg&#39;|&#39;.config&#39;)</code>, the file contains the properties for a Managed Service. The <code>&lt;pid&gt;</code> is then the PID of the Managed Service. See the Configuration Admin service for details.</p>
<p>When a Managed Service Factory is used, the situation is different. The <code>&lt;pid&gt;</code> part then describes the PID of the Managed Service Factory. You can pick any <code>&lt;subname&gt;</code>, the installer will then create an instance for the factory for each unique name. For example:</p>
<pre><code>com.acme.xyz.cfg // configuration for Managed Service
// com.acme.xyz
com.acme.abc-default.cfg // Managed Service Factory,
// creates an instance for com.acme.abc
</code></pre>
<p>If a configuration is modified, the file installer will write the configuration back to a file to ensure persistence across restarts (if <code>sling.fileinstall.writeback</code> is enabled). A similar writeback mechanism is supported by the <a href="jcr-installer-provider.html">JCR installer</a>.</p>
<p>The code for parsing the configuration files is in <a href="https://github.com/apache/sling-org-apache-sling-installer-core/blob/0a34e33dd26092437be5180e34979abbf9a88300/src/main/java/org/apache/sling/installer/core/impl/InternalResource.java#L221">InternalResource#readDictionary</a>.</p>
<h3><a href="#property-files-cfg-" name="property-files-cfg-">Property Files (.cfg)</a></h3>
<p>Configuration files ending in <code>.cfg</code> are plain property files (<code>java.util.Property</code>). The format is simple:</p>
<pre><code>file ::= ( header | comment ) *
header ::= &lt;header&gt; ( &#39;:&#39; | &#39;=&#39; ) &lt;value&gt; ( &#39;\&lt;nl&gt; &lt;value&gt; ) *
comment ::= &#39;#&#39; &lt;any&gt;
</code></pre>
<p>Notice that this model only supports string properties. For example:</p>
<pre><code># default port
ftp.port = 21
</code></pre>
<p>In addition the XML format defined by [java.util.Property](https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html#loadFromXML(java.io.InputStream)) is supported if the file starts with the character <code>&lt;</code>.</p>
<h3><a href="#configuration-files-config-" name="configuration-files-config-">Configuration Files (.config)</a></h3>
<p>Configuration files ending in <code>.config</code> use the format of the <a href="https://github.com/apache/felix/blob/trunk/configadmin/src/main/java/org/apache/felix/cm/file/ConfigurationHandler.java">Apache Felix ConfigAdmin implementation</a>. It allows to specify the type and cardinality of a configuration property and is not limited to string values.</p>
<p>The first line of such a file might start with a comment line (a line starting with a #). Comments within the file are not allowed.</p>
<p>The format is:</p>
<pre><code>file ::= (comment) (header) *
comment ::= &#39;#&#39; &lt;any&gt;
header ::= prop &#39;=&#39; value
prop ::= symbolic-name // 1.4.2 of OSGi Core Specification
symbolic-name ::= token { &#39;.&#39; token } 
token ::= { [ 0..9 ] | [ a..z ] | [ A..Z ] | &#39;_&#39; | &#39;-&#39; }
value ::= [ type ] ( &#39;[&#39; values &#39;]&#39; | &#39;(&#39; values &#39;)&#39; | simple ) 
values ::= simple { &#39;,&#39; simple } 
simple ::= &#39;&quot;&#39; stringsimple &#39;&quot;&#39;
type ::= &lt;1-char type code&gt;
stringsimple ::= &lt;quoted string representation of the value where both &#39;&quot;&#39; and &#39;=&#39; need to be escaped&gt;
</code></pre>
<p>The quoted string format is equal to the definition from HTTP 1.1 (<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec2.html">RFC2616</a>), except that both '"' and '=' need to be escaped.</p>
<p>The 1 character type code is one of:</p>
<ul>
  <li><code>T</code> : simple string</li>
  <li><code>I</code> : Integer</li>
  <li><code>L</code> : Long</li>
  <li><code>F</code> : Float</li>
  <li><code>D</code> : Double</li>
  <li><code>X</code> : Byte</li>
  <li><code>S</code> : Short</li>
  <li><code>C</code> : Character</li>
  <li><code>B</code> : Boolean</li>
</ul>
<p>For Float and Double types the methods <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Float.html#intBitsToFloat%28int%29">Float.intBitsToFloat</a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#longBitsToDouble%28long%29">Double.longBitsToDouble</a> are being used to convert the numeric string into the correct type. These methods rely on the IEEE 754 floating-point formats described in <a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">Single-precision floating-point format</a> and <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">Double-precision floating-point format</a>. A more user-friendly format is not yet supported for these types (<a href="https://issues.apache.org/jira/browse/SLING-7757">SLING-7757</a>).</p>
<p>A number of such .config files exist in the Sling codebase and can be used as examples.</p>
<h1><a href="#project-info" name="project-info">Project Info</a></h1>
<ul>
  <li>Configuration installer factory (<a href="https://github.com/apache/sling-org-apache-sling-installer-factory-configuration">org.apache.sling.installer.factory.configuration</a>)</li>
</ul></section></div></div>            
            <div class="footer">
<div class="revisionInfo">
                    Last modified by <span class="author">Konrad Windszus</span> on <span class="comment">Thu Jun 28 10:33:26 2018 +0200</span>
                </div>                <p>
                    Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                </p><p>
                    Copyright © 2007-2018 The Apache Software Foundation.
                </p>
            </div>
            
        </div>
    </body>
</html>