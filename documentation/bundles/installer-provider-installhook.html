<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Installer Vault Package Install Hook</title>
        <link rel="icon" href="/res/favicon.ico"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
<div class="title">
            <div class="logo">
                <a href="http://sling.apache.org">
                    <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                </a>
            </div><div class="header">
                <a href="http://www.apache.org">
                    <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                </a>
            </div>
        </div><div class="menu">
            <p>
                <strong><a href="/documentation.html">Documentation</a></strong><br/>
                <a href="/documentation/getting-started.html">Getting Started</a><br/>
                <a href="/documentation/the-sling-engine.html">The Sling Engine</a><br/>
                <a href="/documentation/development.html">Development</a><br/>
                <a href="/documentation/bundles.html">Bundles</a><br/>
                <a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a><br/>
                <a href="http://sling.apache.org/components/">Maven Plugins</a><br/>
                <a href="/documentation/configuration.html">Configuration</a>
                
            </p><p>
                <a href="http://s.apache.org/sling.wiki">Wiki</a><br/>
                <a href="http://s.apache.org/sling.faq">FAQ</a><br/>
                
            </p><p>
                <strong>API Docs</strong><br/>
                <a href="/apidocs/sling10/index.html">Sling 10</a><br/>
                <a href="/apidocs/sling9/index.html">Sling 9</a><br/>
                <a href="/documentation/apidocs.html">All versions</a><br/>
                
            </p><p>
                <strong>Project Info</strong><br/>
                <a href="/downloads.cgi">Downloads</a><br/>
                <a href="http://www.apache.org/licenses/">License</a><br/>
                <a href="/news.html">News</a><br/>
                <a href="/releases.html">Releases</a><br/>
                <a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a><br/>
                <a href="/links.html">Links</a><br/>
                <a href="/contributing.html">Contributing</a><br/>
                <a href="/project-information.html">Project Information</a><br/>
                <a href="/project-information/security.html">Security</a><br/>
                
            </p><p>
                <strong>Source</strong><br/>
                <a href="https://github.com/apache/?utf8=%E2%9C%93&q=sling">GitHub</a><br/>
                <a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a><br/>
                
            </p><p>
                <strong><a href="/sitemap.html">Site Map</a></strong>
            </p><p>
                <strong>Apache Software Foundation</strong><br/>
                <a href="http://www.apache.org/foundation/thanks.html">Thanks!</a><br/>
                <a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a><br/>
                <a href="http://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a><br/>
                <a href="https://www.apache.org/events/current-event.html">
                    <img border="0" alt="Current ASF Events" src="https://www.apache.org/events/current-event-125x125.png" width="125px"/>
                </a><a href="http://apache.org/foundation/contributing.html">
                    <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125px"/>
                </a>
            </p>
        </div>        <div class="main">
            <div class="pagenav">
<div class="breadcrumbs">
                    <a href="/">
                        Home
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation.html">
                        Documentation
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation/bundles.html">
                        Bundles
                    </a>&nbsp;&raquo;&nbsp;
                </div>                
<div class="tags">
                    <a href="/tags/installer.html" class="label">
                        installer
                    </a> 
                </div>                
                
            </div><h1 class="pagetitle">
                Installer Vault Package Install Hook
            </h1><div id="generatedToC"></div><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=pagetitle],h2,h3'}); } );</script>
<div class="row"><div class="small-12 columns"><section class="wrap"><h2><a href="#overview" name="overview">Overview</a></h2>
<p>The Installer Vault Package Install Hook allows to install bundles and configurations synchronously during vault package installation by feeding them directly to the <a href="/documentation/bundles/osgi-installer.html">OSGI installer core</a>. That way <a href="http://jackrabbit.apache.org/filevault/properties.html">vault package dependencies</a> can be used to not only depend on content of a package, but also on configurations and bundles contained in a package (the installer install hook has to be added to the package the dependency points to). The mechanism is useful for scenarios when a package contains custom oak restrictions (e.g. <a href="/documentationbundles/sling-oak-restrictions.html">Sling Oak Restrictions</a>) or other install hook(s) that use the install hook package property (e.g. <code>installhook.myhook.class</code>) to reference OSGi services that are provided by another bundle. Also see <a href="https://issues.apache.org/jira/browse/SLING-7790">SLING-7790</a></p>
<h2><a href="#installation-process" name="installation-process">Installation Process</a></h2>
<p>The Installer Vault Package Install Hook scans through the contained files and installs bundles (extension <code>jar</code>) and OSGi configurations with extension <code>config</code> (<code>conf</code> and node configurations are not supported). Runmode folders (e.g. <code>install.publish</code> or <code>config.author</code>) are supported. To perform the installation, the hook registers the installable resources to the OSGi installer core with the exact same digest as the JCR installer would do (hence the JCR installer that will also process the resource but without causing any change as the digest matches). Files that are already installed are ignored (this is checked using <a href="http://sling.apache.org/apidocs/sling10/org/apache/sling/installer/api/info/InfoProvider.html">InfoProvider.html</a>)</p>
<h2><a href="#configuration" name="configuration">Configuration</a></h2>
<p>To include the install hook into a content package, use the following code:</p>
<pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;copy-hook-into-package&lt;/id&gt;
            &lt;phase&gt;generate-resources&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;copy&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;artifactItems&gt;
                    &lt;artifactItem&gt;
                        &lt;groupId&gt;org.apache.sling&lt;/groupId&gt;
                        &lt;artifactId&gt;org.apache.sling.installer.provider.installhook&lt;/artifactId&gt;
                        &lt;version&gt;1.0.0&lt;/version&gt;
                    &lt;/artifactItem&gt;
                &lt;/artifactItems&gt;
                &lt;outputDirectory&gt;${project.build.directory}/vault-work/META-INF/vault/hooks&lt;/outputDirectory&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<p>The following package properties are supported (only <code>installPathRegex</code> is required):</p>
<table>
  <thead>
    <tr>
      <th>Property </th>
      <th>Value</th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>installPathRegex</code> </td>
      <td>Regex, e.g. <code>/apps/myproj/.*</code> or <code>/apps/myproj/install/mybundle-1.0.0.jar</code> </td>
      <td>Regex to match all bundles/configurations to be installed synchronously, . Note: The JCR installer will pick up paths that are not matched asynchronously</td>
    </tr>
    <tr>
      <td><code>maxWaitForOsgiInstallerInSec</code> </td>
      <td>defaults to 60 sec </td>
      <td>Maximum wait time until installation is successful </td>
    </tr>
    <tr>
      <td><code>waitForOsgiEventsQuietInSec</code> </td>
      <td>defaults to 1 sec </td>
      <td>Time to wait for OSGi events to go quiet. Default normally works well for bundles, for certain configurations that trigger restart of bundles this can be increased. </td>
    </tr>
    <tr>
      <td><code>osgiInstallerPriority</code> </td>
      <td>defaults to 2000 </td>
      <td>Priority, by default higher than the standard installation priority of the JCR installer to ensure bundles/configs from this mechanism take higher priority </td>
    </tr>
    <tr>
      <td><code>installhook.installer.class</code> </td>
      <td><code>org.apache.sling.installer.provider.installhook.OsgiInstallerHook</code> </td>
      <td>Alternative to including the hook in package, however then the bundle <code>org.apache.sling.installer.provider.installhook</code> needs to be installed as prerequisite </td>
    </tr>
  </tbody>
</table></section></div></div>            
            <div class="footer">
<div class="revisionInfo">
                    Last modified by <span class="author">georg.henzler</span> on <span class="comment">Wed Oct 10 23:06:10 2018 +0200</span>
                </div>                <p>
                    Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                </p><p>
                    Copyright © 2007-2018 The Apache Software Foundation.
                </p>
            </div>
            
        </div>
    </body>
</html>