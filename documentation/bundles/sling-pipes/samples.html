<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Sample pipes</title>
        <link rel="icon" href="/res/favicon.ico"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
<div class="title">
            <div class="logo">
                <a href="http://sling.apache.org">
                    <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                </a>
            </div><div class="header">
                <a href="http://www.apache.org">
                    <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                </a>
            </div>
        </div><div class="menu">
            <p>
                <strong><a href="/documentation.html">Documentation</a></strong><br/>
                <a href="/documentation/getting-started.html">Getting Started</a><br/>
                <a href="/documentation/the-sling-engine.html">The Sling Engine</a><br/>
                <a href="/documentation/development.html">Development</a><br/>
                <a href="/documentation/bundles.html">Bundles</a><br/>
                <a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a><br/>
                <a href="http://sling.apache.org/components/">Maven Plugins</a><br/>
                <a href="/documentation/configuration.html">Configuration</a>
                
            </p><p>
                <a href="http://s.apache.org/sling.wiki">Wiki</a><br/>
                <a href="http://s.apache.org/sling.faq">FAQ</a><br/>
                
            </p><p>
                <strong>API Docs</strong><br/>
                <a href="/apidocs/sling11/index.html">Sling 11</a><br/>
                <a href="/apidocs/sling10/index.html">Sling 10</a><br/>
                <a href="/apidocs/sling9/index.html">Sling 9</a><br/>
                <a href="/documentation/apidocs.html">All versions</a><br/>
                
            </p><p>
                <strong>Project Info</strong><br/>
                <a href="/downloads.cgi">Downloads</a><br/>
                <a href="http://www.apache.org/licenses/">License</a><br/>
                <a href="/news.html">News</a><br/>
                <a href="/releases.html">Releases</a><br/>
                <a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a><br/>
                <a href="/links.html">Links</a><br/>
                <a href="/contributing.html">Contributing</a><br/>
                <a href="/project-information.html">Project Information</a><br/>
                <a href="/project-information/security.html">Security</a><br/>
                
            </p><p>
                <strong>Source</strong><br/>
                <a href="https://github.com/apache/?utf8=%E2%9C%93&q=sling">GitHub</a><br/>
                <a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a><br/>
                
            </p><p>
                <strong><a href="/sitemap.html">Site Map</a></strong>
            </p><p>
                <strong>Apache Software Foundation</strong><br/>
                <a href="http://www.apache.org/foundation/thanks.html">Thanks!</a><br/>
                <a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a><br/>
                <a href="http://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a><br/>
                <a href="https://www.apache.org/events/current-event.html">
                    <img border="0" alt="Current ASF Events" src="https://www.apache.org/events/current-event-125x125.png" width="125px"/>
                </a><a href="http://apache.org/foundation/contributing.html">
                    <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125px"/>
                </a>
            </p>
        </div>        <div class="main">
            <div class="pagenav">
<div class="breadcrumbs">
                    <a href="/">
                        Home
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation.html">
                        Documentation
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation/bundles.html">
                        Bundles
                    </a>&nbsp;&raquo;&nbsp;<a href="/documentation/bundles/sling-pipes.html">
                        Sling Pipes
                    </a>&nbsp;&raquo;&nbsp;
                </div>                
<div class="tags">
                    <a href="/tags/pipes.html" class="label">
                        pipes
                    </a> 
                </div>                
                
            </div><h1 class="pagetitle">
                Sample pipes
            </h1><div id="generatedToC"></div><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=pagetitle],h2,h3'}); } );</script>
<div class="row"><div class="small-12 columns"><section class="wrap"><h2><a href="#pipebuilder-samples" name="pipebuilder-samples">Pipebuilder samples</a></h2>
<p>those are samples built with pipebuilder api you can </p>
<h3>echo | $ | children | write</h3>
<p>write repository user prefix Ms/Mr depending on gender</p>
<pre><code>  echo(&#39;/home/users&#39;)
  .$(&#39;rep:User&#39;)
  .children(&quot;nt:unstructured#profile&quot;)
  .write(&quot;fullName&quot;,&quot;${(profile.gender === &#39;female&#39; ? &#39;Ms &#39; + profile.fullName : &#39;Mr &#39; + profile.fullName)}&quot;)
</code></pre>
<h3>echo | $ | multiProperty | auth | write</h3>
<p>move badge&lt;-&gt;user relation ship from badge-&gt;users MV property to a user-&gt;badges MV property</p>
<pre><code> .echo(&#39;/etc/badges/jcr:content/par&#39;)
 .$(&#39;[sling:resourceType=myApp/components/badge]&#39;).name(&#39;badge&#39;)
 .pipe(&#39;slingPipes/multiProperty&#39;).path(&#39;${path.badge}/profiles&#39;).name(&#39;profile&#39;)
 .auth(&#39;${profile}&#39;).name(&#39;user&#39;)
 .echo(&#39;${path.user}/profile&#39;)
 .write(&#39;badges&#39;,&#39;+[${path.badge}]&#39;)
</code></pre>
<h5>echo | children | children | echo | json | write</h5>
<p>this use case is for completing repository website with external system's data (that has an json api), it does </p>
<ul>
  <li>loop over "my:Page" country/language tree under <code>/content/mySite</code>,</li>
  <li>fetch json with contextual parameter that must be in upper case,</li>
  <li>and write part of the returned json in the current resource.</li>
</ul>
<p>This pipe is run asynchronously in case the execution takes long.</p>
<pre><code> .echo(&quot;/content/mySite&quot;)
 .children(&#39;my:Page&#39;)
 .children(&#39;my:Page&#39;).name(&quot;localePage&quot;)
 .echo(&#39;${path.localePage}/jcr:content&#39;).name(&quot;content&quot;)
 .json(&#39;https://www.external.com/api/${content.country.toUpperCase()}.json.name(&#39;api&#39;)
 .write(&#39;cachedValue&#39;,&#39;${api.remoteJsonValueWeWant}&#39;)
</code></pre>
<h5>echo | $ | parent | rm</h5>
<ul>
  <li>query all user profile nodes with bad properties,</li>
  <li>get the parent node (user node)</li>
  <li>remove it
    <pre><code>.echo(&quot;/home/users&quot;)
.$(&quot;profile[@bad]&quot;)
.parent()
.rm()
</code></pre>
  </li>
</ul>
<p>some other samples are in https://github.com/npeltier/sling-pipes/tree/master/src/test/</p></section></div></div>            
            <div class="footer">
<div class="revisionInfo">
                    Last modified by <span class="author">npeltier</span> on <span class="comment">Sat Jan 27 22:17:38 2018 +0100</span>
                </div>                <p>
                    Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                </p><p>
                    Copyright © 2007-2018 The Apache Software Foundation.
                </p>
            </div>
            
        </div>
    </body>
</html>